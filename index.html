<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <title>Trust Token API</title>
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <link href="https://www.w3.org/StyleSheets/TR/2021/cg-draft" rel="stylesheet">
  <meta content="Bikeshed version 44af0bf3e, updated Fri Jul 29 17:05:16 2022 -0700" name="generator">
  <link href="https://wicg.github.io/trust-token-api/" rel="canonical">
  <meta content="066bc9006b17297158a5e3571275d9993b4b5bc0" name="document-revision">
<style>/* style-autolinks */

.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}</style>
<style>/* style-colors */

/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}</style>
<style>/* style-counters */

body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}</style>
<style>/* style-issues */

a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* style-md-lists */

/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}</style>
<style>/* style-selflinks */

:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* style-syntax-highlighting */

code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }

.highlight:not(.idl) { background: rgba(0, 0, 0, .03); }
c-[a] { color: #990055 } /* Keyword.Declaration */
c-[b] { color: #990055 } /* Keyword.Type */
c-[c] { color: #708090 } /* Comment */
c-[d] { color: #708090 } /* Comment.Multiline */
c-[e] { color: #0077aa } /* Name.Attribute */
c-[f] { color: #669900 } /* Name.Tag */
c-[g] { color: #222222 } /* Name.Variable */
c-[k] { color: #990055 } /* Keyword */
c-[l] { color: #000000 } /* Literal */
c-[m] { color: #000000 } /* Literal.Number */
c-[n] { color: #0077aa } /* Name */
c-[o] { color: #999999 } /* Operator */
c-[p] { color: #999999 } /* Punctuation */
c-[s] { color: #a67f59 } /* Literal.String */
c-[t] { color: #a67f59 } /* Literal.String.Single */
c-[u] { color: #a67f59 } /* Literal.String.Double */
c-[cp] { color: #708090 } /* Comment.Preproc */
c-[c1] { color: #708090 } /* Comment.Single */
c-[cs] { color: #708090 } /* Comment.Special */
c-[kc] { color: #990055 } /* Keyword.Constant */
c-[kn] { color: #990055 } /* Keyword.Namespace */
c-[kp] { color: #990055 } /* Keyword.Pseudo */
c-[kr] { color: #990055 } /* Keyword.Reserved */
c-[ld] { color: #000000 } /* Literal.Date */
c-[nc] { color: #0077aa } /* Name.Class */
c-[no] { color: #0077aa } /* Name.Constant */
c-[nd] { color: #0077aa } /* Name.Decorator */
c-[ni] { color: #0077aa } /* Name.Entity */
c-[ne] { color: #0077aa } /* Name.Exception */
c-[nf] { color: #0077aa } /* Name.Function */
c-[nl] { color: #0077aa } /* Name.Label */
c-[nn] { color: #0077aa } /* Name.Namespace */
c-[py] { color: #0077aa } /* Name.Property */
c-[ow] { color: #999999 } /* Operator.Word */
c-[mb] { color: #000000 } /* Literal.Number.Bin */
c-[mf] { color: #000000 } /* Literal.Number.Float */
c-[mh] { color: #000000 } /* Literal.Number.Hex */
c-[mi] { color: #000000 } /* Literal.Number.Integer */
c-[mo] { color: #000000 } /* Literal.Number.Oct */
c-[sb] { color: #a67f59 } /* Literal.String.Backtick */
c-[sc] { color: #a67f59 } /* Literal.String.Char */
c-[sd] { color: #a67f59 } /* Literal.String.Doc */
c-[se] { color: #a67f59 } /* Literal.String.Escape */
c-[sh] { color: #a67f59 } /* Literal.String.Heredoc */
c-[si] { color: #a67f59 } /* Literal.String.Interpol */
c-[sx] { color: #a67f59 } /* Literal.String.Other */
c-[sr] { color: #a67f59 } /* Literal.String.Regex */
c-[ss] { color: #a67f59 } /* Literal.String.Symbol */
c-[vc] { color: #0077aa } /* Name.Variable.Class */
c-[vg] { color: #0077aa } /* Name.Variable.Global */
c-[vi] { color: #0077aa } /* Name.Variable.Instance */
c-[il] { color: #000000 } /* Literal.Number.Integer.Long */
</style>
<style>/* style-darkmode */

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}

@media (prefers-color-scheme: dark) {
    .highlight:not(.idl) { background: rgba(255, 255, 255, .05); }

    c-[a] { color: #d33682 } /* Keyword.Declaration */
    c-[b] { color: #d33682 } /* Keyword.Type */
    c-[c] { color: #2aa198 } /* Comment */
    c-[d] { color: #2aa198 } /* Comment.Multiline */
    c-[e] { color: #268bd2 } /* Name.Attribute */
    c-[f] { color: #b58900 } /* Name.Tag */
    c-[g] { color: #cb4b16 } /* Name.Variable */
    c-[k] { color: #d33682 } /* Keyword */
    c-[l] { color: #657b83 } /* Literal */
    c-[m] { color: #657b83 } /* Literal.Number */
    c-[n] { color: #268bd2 } /* Name */
    c-[o] { color: #657b83 } /* Operator */
    c-[p] { color: #657b83 } /* Punctuation */
    c-[s] { color: #6c71c4 } /* Literal.String */
    c-[t] { color: #6c71c4 } /* Literal.String.Single */
    c-[u] { color: #6c71c4 } /* Literal.String.Double */
    c-[ch] { color: #2aa198 } /* Comment.Hashbang */
    c-[cp] { color: #2aa198 } /* Comment.Preproc */
    c-[cpf] { color: #2aa198 } /* Comment.PreprocFile */
    c-[c1] { color: #2aa198 } /* Comment.Single */
    c-[cs] { color: #2aa198 } /* Comment.Special */
    c-[kc] { color: #d33682 } /* Keyword.Constant */
    c-[kn] { color: #d33682 } /* Keyword.Namespace */
    c-[kp] { color: #d33682 } /* Keyword.Pseudo */
    c-[kr] { color: #d33682 } /* Keyword.Reserved */
    c-[ld] { color: #657b83 } /* Literal.Date */
    c-[nc] { color: #268bd2 } /* Name.Class */
    c-[no] { color: #268bd2 } /* Name.Constant */
    c-[nd] { color: #268bd2 } /* Name.Decorator */
    c-[ni] { color: #268bd2 } /* Name.Entity */
    c-[ne] { color: #268bd2 } /* Name.Exception */
    c-[nf] { color: #268bd2 } /* Name.Function */
    c-[nl] { color: #268bd2 } /* Name.Label */
    c-[nn] { color: #268bd2 } /* Name.Namespace */
    c-[py] { color: #268bd2 } /* Name.Property */
    c-[ow] { color: #657b83 } /* Operator.Word */
    c-[mb] { color: #657b83 } /* Literal.Number.Bin */
    c-[mf] { color: #657b83 } /* Literal.Number.Float */
    c-[mh] { color: #657b83 } /* Literal.Number.Hex */
    c-[mi] { color: #657b83 } /* Literal.Number.Integer */
    c-[mo] { color: #657b83 } /* Literal.Number.Oct */
    c-[sa] { color: #6c71c4 } /* Literal.String.Affix */
    c-[sb] { color: #6c71c4 } /* Literal.String.Backtick */
    c-[sc] { color: #6c71c4 } /* Literal.String.Char */
    c-[dl] { color: #6c71c4 } /* Literal.String.Delimiter */
    c-[sd] { color: #6c71c4 } /* Literal.String.Doc */
    c-[se] { color: #6c71c4 } /* Literal.String.Escape */
    c-[sh] { color: #6c71c4 } /* Literal.String.Heredoc */
    c-[si] { color: #6c71c4 } /* Literal.String.Interpol */
    c-[sx] { color: #6c71c4 } /* Literal.String.Other */
    c-[sr] { color: #6c71c4 } /* Literal.String.Regex */
    c-[ss] { color: #6c71c4 } /* Literal.String.Symbol */
    c-[fm] { color: #268bd2 } /* Name.Function.Magic */
    c-[vc] { color: #cb4b16 } /* Name.Variable.Class */
    c-[vg] { color: #cb4b16 } /* Name.Variable.Global */
    c-[vi] { color: #cb4b16 } /* Name.Variable.Instance */
    c-[vm] { color: #cb4b16 } /* Name.Variable.Magic */
    c-[il] { color: #657b83 } /* Literal.Number.Integer.Long */
}
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72"> </a> </p>
   <h1 class="p-name no-ref" id="title">Trust Token API</h1>
   <p id="w3c-state"><a href="https://www.w3.org/standards/types#CG-DRAFT">Draft Community Group Report</a>, <time class="dt-updated" datetime="2022-10-06">6 October 2022</time></p>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>This version:
     <dd><a class="u-url" href="https://wicg.github.io/trust-token-api/">https://wicg.github.io/trust-token-api/</a>
     <dt>Issue Tracking:
     <dd><a href="https://github.com/WICG/trust-token-api/issues/">GitHub</a>
     <dt class="editor">Editor:
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:aykutb@google.com">Aykut Bulut</a> (<a class="p-org org" href="https://www.google.com/">Google</a>)
     <dt>Participate:
     <dd><a href="https://github.com/WICG/trust-token-api">GitHub WICG/trust-token-api</a> (<a href="https://github.com/WICG/trust-token-api/issues/new">new issue</a>, <a href="https://github.com/WICG/trust-token-api/issues?state=open">open issues</a>)
     <dt>Commits:
     <dd><a href="https://github.com/WICG/trust-token-api/commits/main/spec.bs">GitHub spec.bs commits</a>
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © 2022 the Contributors to the Trust Token API Specification, published by the <a href="https://www.w3.org/community/wicg/">Web Platform Incubator Community Group</a> under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a>.
A human-readable <a href="http://www.w3.org/community/about/agreements/cla-deed/">summary</a> is available. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>Trust Token is a web platform API that allows propagating trust across sites, using the Privacy Pass protocol as an underlying primitive.</p>
  </div>
  <div data-fill-with="at-risk"></div>
  <h2 class="no-num no-toc no-ref heading settled" id="status"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p> This specification was published by the <a href="https://www.w3.org/community/wicg/">Web Platform Incubator Community Group</a>.
  It is not a W3C Standard nor is it on the W3C Standards Track.

  Please note that under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a> there is a limited opt-out and other conditions apply.

  Learn more about <a href="http://www.w3.org/community/">W3C Community and Business Groups</a>. </p>
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li><a href="#goals"><span class="secno">1</span> <span class="content">Goals</span></a>
    <li><a href="#background"><span class="secno">2</span> <span class="content">Background</span></a>
    <li><a href="#issuer-public-keys"><span class="secno">3</span> <span class="content">Issuer Public Keys</span></a>
    <li>
     <a href="#issuing-protocol"><span class="secno">4</span> <span class="content">Issuing Protocol</span></a>
     <ol class="toc">
      <li><a href="#browser-issue-steps"><span class="secno">4.1</span> <span class="content">Browser Steps For Creating Issue Request</span></a>
      <li><a href="#issuer-signing-tokens"><span class="secno">4.2</span> <span class="content">Issuer Signing Tokens</span></a>
      <li><a href="#browser-issue-response"><span class="secno">4.3</span> <span class="content">Browser Steps For Issue Response</span></a>
     </ol>
    <li>
     <a href="#redeeming-tokens"><span class="secno">5</span> <span class="content">Redeeming Tokens</span></a>
     <ol class="toc">
      <li><a href="#redemption-records"><span class="secno">5.1</span> <span class="content">Redemption Records</span></a>
     </ol>
    <li>
     <a href="#query-apis"><span class="secno">6</span> <span class="content">Query APIs</span></a>
     <ol class="toc">
      <li><a href="#token-query"><span class="secno">6.1</span> <span class="content">Token Query</span></a>
      <li><a href="#redemption-record-query"><span class="secno">6.2</span> <span class="content">Redemption Record Query</span></a>
     </ol>
    <li>
     <a href="#privacy"><span class="secno">7</span> <span class="content">Privacy Considerations</span></a>
     <ol class="toc">
      <li><a href="#unlinkability"><span class="secno">7.1</span> <span class="content">Unlinkability</span></a>
      <li>
       <a href="#limit-encoded-info"><span class="secno">7.2</span> <span class="content">Limiting Encoded Information</span></a>
       <ol class="toc">
        <li><a href="#potential-attack-side-channel-fingerprinting"><span class="secno">7.2.1</span> <span class="content">Potential Attack: Side Channel Fingerprinting</span></a>
       </ol>
      <li>
       <a href="#cross-site-info"><span class="secno">7.3</span> <span class="content">Cross-site Information Transfer</span></a>
       <ol class="toc">
        <li><a href="#mitigation-dynamic-issuance-redemption-limits"><span class="secno">7.3.1</span> <span class="content">Mitigation: Dynamic Issuance/Redemption Limits</span></a>
        <li><a href="#mitigation-per-site-issuer-limits"><span class="secno">7.3.2</span> <span class="content">Mitigation: Per-Site Issuer Limits</span></a>
       </ol>
     </ol>
    <li>
     <a href="#security"><span class="secno">8</span> <span class="content">Security Considerations</span></a>
     <ol class="toc">
      <li><a href="#token-exhaustion"><span class="secno">8.1</span> <span class="content">Preventing Token Exhaustion</span></a>
      <li><a href="#preventing-double-spend"><span class="secno">8.2</span> <span class="content">Preventing Double Spending</span></a>
     </ol>
    <li>
     <a href="#w3c-conformance"><span class="secno"></span> <span class="content">Conformance</span></a>
     <ol class="toc">
      <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content">Document conventions</span></a>
      <li><a href="#w3c-conformant-algorithms"><span class="secno"></span> <span class="content">Conformant Algorithms</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
   </ol>
  </nav>
  <main>
   <p><strong>This is a working version and is subject to change.</strong></p>
   <h2 class="heading settled" data-level="1" id="goals"><span class="secno">1. </span><span class="content">Goals</span><a class="self-link" href="#goals"></a></h2>
   <p>Goal of Trust Token API is to transfer limited amount of signals across sites
through time in a privacy preserving manner. It achieves this using privacy
pass protocol <a data-link-type="biblio" href="#biblio-privacy-pass-issuance-protocol">[PRIVACY-PASS-ISSUANCE-PROTOCOL]</a> specified in working documents
of privacy pass working group of IETF <a data-link-type="biblio" href="#biblio-privacy-pass-wg">[PRIVACY-PASS-WG]</a>. Trust Tokens can be
considered as a web platform implementation of Privacy Pass.</p>
   <h2 class="heading settled" data-level="2" id="background"><span class="secno">2. </span><span class="content">Background</span><a class="self-link" href="#background"></a></h2>
   <p>Trust Token API provides a mechanism for anonymous authentication. Trust Token
mechanism provided by browser does not authenticate clients, instead it
facilitates transfer of authentication information. Trust Token API performs
cross site anonymous authentication without using linkable state carrying
cookies <a data-link-type="biblio" href="#biblio-rfc6265">[RFC6265]</a>. Cookies do provide cross site authentication, however,
fail to provide anonymity.</p>
   <p>Authentication of the clients and token signing are both carried by the same
entity referred as the <strong>issuer</strong>. This is the joint attester and issuer
architecture described in <a data-link-type="biblio" href="#biblio-privacy-pass-architecture">[PRIVACY-PASS-ARCHITECTURE]</a>, <a data-link-type="biblio" href="#biblio-privacy-pass-auth-scheme">[PRIVACY-PASS-AUTH-SCHEME]</a>.</p>
   <p>Browsers store tokens in persistent storage. Navigated origins might fetch/spend
tokens in first party contexts or include third party code that fetch/spend
tokens. Spending tokens is called <strong>redeeming</strong>.</p>
   <p>Origins may ask browser to fetch tokens from the issuers of their
choice. Tokens can be redeemed from a different origin than the fetching one.</p>
   <p>Trust Token operations rely on <a data-link-type="biblio" href="#biblio-fetch">[FETCH]</a>. A fetch request corresponding to a
specific Trust Token operation can be created and used as a parameter to the
fetch function.</p>
   <h2 class="heading settled" data-level="3" id="issuer-public-keys"><span class="secno">3. </span><span class="content">Issuer Public Keys</span><a class="self-link" href="#issuer-public-keys"></a></h2>
   <p>This section describes the public interfaces that an issuer is required to
support to provide public keys to be used by Trust Token protocols.</p>
   <p>An issuer needs to maintain a set of keys and implement the <strong>Issue</strong> and <strong>Redeem</strong> cryptographic functions to sign and validate tokens. Issuers are
required to serve a <strong>key commitment</strong> endpoint. Key commitments are
collections of cryptographic keys and associated metadata necessary for
executing the issuance and redemption operations. Issuers make these available
through secure HTTP <a data-link-type="biblio" href="#biblio-rfc8446">[RFC8446]</a> endpoints. Browsers should fetch the key
commitments periodically.</p>
   <p>Requests to key commitment endpoints should result in a JSON response <a data-link-type="biblio" href="#biblio-rfc8259">[RFC8259]</a> of the following format.</p>
<pre class="language-javascript highlight"><c- p>{</c->
  <c- o>&lt;</c->cryptographic protocol_version<c- o>>:</c-> <c- p>{</c->
    <c- u>"protocol_version"</c-><c- o>:</c-> <c- o>&lt;</c->cryptographic protocol version<c- o>></c-><c- p>,</c->
    <c- u>"id"</c-><c- o>:</c-> <c- o>&lt;</c->key commitment identifier<c- o>></c->
    <c- u>"batchsize"</c-><c- o>:</c-> <c- o>&lt;</c->batch size<c- o>></c-><c- p>,</c->
    <c- u>"keys"</c-><c- o>:</c-> <c- p>{</c->
      <c- o>&lt;</c->keyID<c- o>>:</c-> <c- p>{</c-> <c- u>"Y"</c-><c- o>:</c-> <c- o>&lt;</c->base64<c- o>-</c->encoded <c- kr>public</c-> key<c- o>></c-><c- p>,</c->
                 <c- u>"expiry"</c-><c- o>:</c-> <c- o>&lt;</c->key expirion data<c- o>></c-><c- p>},</c->
      <c- o>&lt;</c->keyID<c- o>>:</c-> <c- p>{</c-> <c- u>"Y"</c-><c- o>:</c-> <c- o>&lt;</c->base64<c- o>-</c->encoded <c- kr>public</c-> key<c- o>></c-><c- p>,</c->
                 <c- u>"expiry"</c-><c- o>:</c-> <c- o>&lt;</c->key expirion data<c- p>},</c-> <c- p>...</c->
    <c- p>}</c->
  <c- p>},</c->
  <c- p>...</c->
<c- p>}</c->
</pre>
   <ul>
    <li data-md>
     <p><code>&lt;cryptographic protocol version></code> is a string identifier for the Trust Token
protocol version used. The same string is used as a value of the inner <code>"protocol_version"</code> field. Protocol version string identifier is either <code>"TrustTokenV3PMB"</code> or <code>"TrustTokenV3VOPRF"</code>. Both protocols have similar
properties in terms of privacy implications.</p>
     <ul>
      <li data-md>
       <p>Protocol version <code>“TrustTokenV3PMB”</code> implements <a data-link-type="biblio" href="#biblio-pmb">[PMB]</a> cryptographic
       protocol. In this protocol, each token contains a private
       metadata bit.</p>
      <li data-md>
       <p>Protocol version <code>“TrustTokenV2VOPRF”</code> implements <a data-link-type="biblio" href="#biblio-voprf">[VOPRF]</a> cryptographic
       protocol. Contrary to PMB, tokens do not contain private
       metadata bits. However, issuers can use twice as many
       concurrently valid token signing keys (six compared to three of
       PMB).</p>
     </ul>
    <li data-md>
     <p><code>"id"</code> field provides the identifier of the key commitment. It is a string
     representation of a non-negative integer that is within the range of
     an unsigned 32 bit integer type. Values should be montonically
     increasing.</p>
    <li data-md>
     <p><code>"batchsize"</code> specifies the maximum number of blinded tokens that the issuer
            supports for each token issuance operation. Its value is a
            string representation of a positive integer. Maximum value
            allowed is 100. If a larger value is specified, 100 will be
            used. Browser might send fewer tokens in a single operation,
            but will generally default to sending <code>batchsize</code> many tokens
            per operation.</p>
    <li data-md>
     <p><code>"keys"</code> field is a dictionary of public keys listed by their identifiers.</p>
     <ul>
      <li data-md>
       <p><code>&lt;keyID></code> is a string representation of a non-negative integer that
   is within the range of an unsigned 32 bit integer type.</p>
      <li data-md>
       <p>Each key has a <code>"Y"</code> field which is a string representation of a
    big-endian base64 encoding <a data-link-type="biblio" href="#biblio-rfc4648">[RFC4648]</a> of the byte string of
    the key.</p>
      <li data-md>
       <p><code>"expiry"</code> field specifies how long the underlying key is valid. It
          is a string representation of a nonnegative integer that
          is within the range of an unsigned 64 bit integer type.
          Underlying key expires if this amount many or more
          microseconds are elapsed since the POSIX epoch <a data-link-type="biblio" href="#biblio-rfc8536">[RFC8536]</a>.</p>
     </ul>
   </ul>
   <p>All field names and their values are strings. When new key commitments are
fetched for an issuer, previous commitments are discarded.</p>
   <h2 class="heading settled" data-level="4" id="issuing-protocol"><span class="secno">4. </span><span class="content">Issuing Protocol</span><a class="self-link" href="#issuing-protocol"></a></h2>
   <p>This section explains the issuing protocol. It has two sections that explains
the issuing protocol steps happenning in browsers and issuers.</p>
   <h3 class="heading settled" data-level="4.1" id="browser-issue-steps"><span class="secno">4.1. </span><span class="content">Browser Steps For Creating Issue Request</span><a class="self-link" href="#browser-issue-steps"></a></h3>
   <p>An issue request is created and fetched as demostrated in the following snippet.</p>
<pre class="language-javascript highlight">issueRequest <c- o>=</c-> <c- ow>new</c-> Request<c- p>(</c-><c- u>"https://example.issuer:1234/issuer_path?public=0&amp;private=0"</c-><c- p>,</c-> <c- p>{</c->
  trustToken<c- o>:</c-> <c- p>{</c->
    type<c- o>:</c-> <c- u>"token-request"</c-><c- p>,</c->
    issuer<c- o>:</c-> <c- u>"https://example.issuer"</c->
  <c- p>}</c->
<c- p>});</c->
fetch<c- p>(</c->issueRequest<c- p>);</c->
</pre>
   <p>An issuance request is parameterized by issuer and top level origins. Following
steps are carried out when an issue request is fetched.</p>
   <ol>
    <li data-md>
     <p>Reject if the document is not in a secure context <a data-link-type="biblio" href="#biblio-secure-contexts">[secure-contexts]</a>.</p>
    <li data-md>
     <p>Reject if associating the issuer with the top level origin would exceed the
       top level’s number-of-issuers limit of 2.</p>
    <li data-md>
     <p>Associate the issuer with the top level origin.</p>
    <li data-md>
     <p>Reject if the number of tokens from the issuer is already at capacity
       which is 500.</p>
    <li data-md>
     <p>Reject if there are no key commitments stored for the issuer.</p>
    <li data-md>
     <p>Pass issuer public keys to cryptographic procedures. Reject if keys are
     malformed.</p>
    <li data-md>
     <p>Discard tokens from issuer that are signed with keys other than those from
        the issuer’s most recent commitments.</p>
    <li data-md>
     <p>Compare issuer’s max batch size to global limit of 100 on batch size. Use
        the smaller value.</p>
    <li data-md>
     <p>Look up the key commitments from storage. Error out if key commitments are
     unavailable.</p>
    <li data-md>
     <p>Identify right number of tokens considering issuer batch size and current
 number of tokens from the issuer.</p>
    <li data-md>
     <p>Generate the right number of blinded tokens identified in Step 10.</p>
    <li data-md>
     <p>Configure the HTTP request.
           a. Set a load flag to bypass the HTTP cache.
           b. Add <code>Sec-Trust-Token</code> request header containing a
                  base64-encoded version of the bytestring of tokens
                  generated in Step 11.
           c. Add <code>Sec-Trust-Token-Version</code> request header that specifies
                  the version of the cryptographic protocol used.</p>
   </ol>
   <p>Trust token HTTP request headers created for a typical fetch is as follows.</p>
<pre>Sec-Trust-Token: &lt;blinded tokens encoded as base64 string>
Sec-Trust-Token-Version: &lt;cryptographic protocol version, VOPRF or PMB>
</pre>
   <h3 class="heading settled" data-level="4.2" id="issuer-signing-tokens"><span class="secno">4.2. </span><span class="content">Issuer Signing Tokens</span><a class="self-link" href="#issuer-signing-tokens"></a></h3>
   <p>This section explains the signing of tokens that happens in the issuer
servers. Information to be encoded in the tokens are passed in the URL <code>public</code> and <code>private</code> parameters. VOPRF can only encode a value from set {0,1,2,3,4,5}
passed in the URL <code>public</code> parameter. PMB can encode a value from set {0,1,2}
in <code>public</code> and a value from set {0,1} in <code>private</code> parameter.</p>
   <p>Using its private keys, issuer signs the blinded tokens obtained in the <code>Sec-Trust-Token</code> request header value. Issuer uses the cryptographic protocol
specified in the request <code>Sec-Trust-Token-Version</code> header. Encoding the values
passed in URL <code>private</code> and <code>public</code> parameters happens in this signing
step. Issuer returns the signed tokens in the <code>Sec-Trust-Token</code> response header
value encoded as a base64 byte string. The number of tokens issued is returned
in <code>Sec-TT-Count</code> header. Value of this header is the string message of <code>Issuing &lt;number of tokens> tokens.</code> with the right nonnegative integer value
that specifies the tokens issued.</p>
   <p>Following snippet displays a typical response demonstrating the Trust Token
related headers.</p>
<pre>Sec-Trust-Token: &lt;token encoded as base64 string>
Sec-TT-Count: Issuing 3 tokens.
</pre>
   <p>Additionally, the issuer may include an optional <code>Sec-Trust-Token-Clear-Data</code> header in the response. If the value of the header is <code>all</code>, then browser
should discard all previously stored tokens before the newly issued tokens are
stored. <code>Sec-Trust-Token-Clear-Data</code> header should be ignored for any other
values.</p>
   <h3 class="heading settled" data-level="4.3" id="browser-issue-response"><span class="secno">4.3. </span><span class="content">Browser Steps For Issue Response</span><a class="self-link" href="#browser-issue-response"></a></h3>
   <p>To process a response to an issue request, browser follows the following steps.</p>
   <ol>
    <li data-md>
     <p>If the response has no <code>Sec-Trust-Token</code> header, return an error.</p>
    <li data-md>
     <p>If the response has an empty <code>Sec-Trust-Token</code> header, return; this is a <code>Success</code> response bearing 0 tokens.</p>
    <li data-md>
     <p>If the response has <code>Sec-Trust-Token-Clear-Data</code> header,
a. If its value is <code>"all"</code> discard all previously stored tokens from the issuer.
b. Else, ignore the header.</p>
    <li data-md>
     <p>Strip the <code>Sec-Trust-Token</code> header from the response and carry out the
cryptographic procedures to obtain a list of unblinded tokens.
a. If the cryptographic procedure succeeds, associate the tokens with the
      issuing key’s label and store the tokens.
b. Else, return an error.</p>
   </ol>
   <h2 class="heading settled" data-level="5" id="redeeming-tokens"><span class="secno">5. </span><span class="content">Redeeming Tokens</span><a class="self-link" href="#redeeming-tokens"></a></h2>
   <p>When browser navigates to an origin, top level origin or a third party site
embedded on the top level origin may redeem tokens stored in browser from a
specific issuer to learn <code>public</code> and/or <code>private</code> data encoded in the
tokens. Redemption is carried through fetch as demonstrated in the following
snippet.</p>
<pre class="language-javascript highlight">redemptionRequest <c- o>=</c-> <c- ow>new</c-> Request<c- p>(</c-><c- t>'https://example.issuer:1234/redemption_path'</c-><c- p>,</c-> <c- p>{</c->
  trustToken<c- o>:</c-> <c- p>{</c->
    type<c- o>:</c-> <c- t>'token-redemption'</c-><c- p>,</c->
    issuer<c- o>:</c-> <c- t>'https://example.issuer'</c-><c- p>,</c->
    refreshPolicy<c- o>:</c-> <c- p>{</c-><c- t>'none'</c-><c- p>,</c-> <c- t>'refresh'</c-><c- p>}</c->
  <c- p>}</c->
<c- p>});</c->
</pre>
   <p>Default value for refreshPolicy is <code>'none'</code>.</p>
   <p>Browser carries the following steps when a redemption request is fetched.</p>
   <ol>
    <li data-md>
     <p>Reject if the document is not in a secure context <a data-link-type="biblio" href="#biblio-secure-contexts">[secure-contexts]</a>.</p>
    <li data-md>
     <p>Reject if associating the issuer with the top level origin would exceed the
       top level’s number-of-issuers limit of 2.</p>
    <li data-md>
     <p>Associate the issuer with the top level origin.</p>
    <li data-md>
     <p>If <code>refreshPolicy</code> is <code>'none'</code>,
    a. If an unexpired redemption record exists in permenant storage,
          return early, add this redemption record to corresponding
          header value. Go to step 11.
    b. Else continue redemption.</p>
    <li data-md>
     <p>If this is the third token exhausting redemption request within the
   last 48 hours, return error.</p>
    <li data-md>
     <p>Look up the key commitments from storage. Error out if key commitments are
     unavailable.</p>
    <li data-md>
     <p>Discard tokens from issuer that are signed with keys other than those from
        the issuer’s most recent commitments.</p>
    <li data-md>
     <p>Return error if there are no tokens stored to redeem.</p>
    <li data-md>
     <p>Retrieve a single token from persistent storage.</p>
    <li data-md>
     <p>Pass token to cryptographic redemption procedure, if procedure fails
     return error.</p>
    <li data-md>
     <p>Set redemption procedure result in <code>Sec-Trust-Token</code> request header.</p>
    <li data-md>
     <p>Set <code>Sec-Trust-Token-Version</code> header value to the cryptographic protocol
      used.</p>
    <li data-md>
     <p>Optionally, set <code>Sec-Trust-Token-Lifetime</code> header.</p>
    <li data-md>
     <p>Configure the HTTP request. Set a load flag to bypass the HTTP cache.</p>
   </ol>
   <p><code>Sec-Trust-Token-Lifetime</code> response header indicates how long (in seconds) the
RR should be cached for. When <code>Sec-Trust-Token-Lifetime</code> response header value
is invalid (too large, a negative number or non-numeric), UA should ignore the <code>Sec-Trust-Token-Lifetime</code> header. When <code>Sec-Trust-Token-Lifetime</code> header value
is zero, UA should treat the record as expired. In case of multiple <code>Sec-Trust-Token-Lifetime</code> headers, UA uses the last one. If <code>Sec-Trust-Token-Lifetime</code> header is omitted, the lifetime of the RR will be
tied to the lifetime of the Trust Token verification key that confirmed the
redeemed token’s issuance. The RR is HTTP-only and JavaScript is only able to
access/send the RR via Trust Token Fetch APIs. The RR is treated as an
arbitrary blob of bytes from the issuer, that may have semantic meaning to
downstream consumers.</p>
   <h3 class="heading settled" data-level="5.1" id="redemption-records"><span class="secno">5.1. </span><span class="content">Redemption Records</span><a class="self-link" href="#redemption-records"></a></h3>
   <p>To reduce communication overhead, the browser might cache blobs returned in <code>Sec-Trust-Token</code> header value in redemption responses. These blobs are
referred as <em>Redemption Records</em>. Browsers might choose to store these records
to include them in subsequent requests to the origins that can verify its
validity. Issuer might choose to include optional <code>Sec-Trust-Token-Lifetime</code> header in the redemption response. The value of this header indicates the
expiration time for the redemption record provided. This expiration is
specified as number of seconds in the <code>Sec-Trust-Token-Lifetime</code> HTTP response
header value.</p>
   <h2 class="heading settled" data-level="6" id="query-apis"><span class="secno">6. </span><span class="content">Query APIs</span><a class="self-link" href="#query-apis"></a></h2>
   <h3 class="heading settled" data-level="6.1" id="token-query"><span class="secno">6.1. </span><span class="content">Token Query</span><a class="self-link" href="#token-query"></a></h3>
   <p>An origin might query whether the browser has any tokens from a specific issuer
using the following API.</p>
<pre class="language-javascript highlight">document<c- p>.</c->hasTrustToken<c- p>(</c-><c- o>&lt;</c->issuer<c- o>></c-><c- p>)</c->
</pre>
   <p>Browser carries the following steps on this query.</p>
   <ol>
    <li data-md>
     <p>Reject if the document is not in a secure context <a data-link-type="biblio" href="#biblio-secure-contexts">[secure-contexts]</a>.</p>
    <li data-md>
     <p>Reject if associating the issuer with the top level origin would exceed the
       top level’s number-of-issuers limit of 2.</p>
    <li data-md>
     <p>Associate the issuer with the top level origin.</p>
    <li data-md>
     <p>Look up the key commitments from storage. If there are key commitments,
     discard tokens from issuer that are signed with keys other than those
     from the issuer’s most recent commitments.</p>
    <li data-md>
     <p>Return true if there are tokens stored for the given issuer, false
       otherwise.</p>
   </ol>
   <p>Note that this query modifies the browser state. It associates the issuer
argument with the current origin. Browser allows at most 2 issuers associated
with an origin. This is to prevent leaking information through the issers a
user has tokens from. Note that token query triggers removal of stale tokens
at Step 4.</p>
   <h3 class="heading settled" data-level="6.2" id="redemption-record-query"><span class="secno">6.2. </span><span class="content">Redemption Record Query</span><a class="self-link" href="#redemption-record-query"></a></h3>
   <p>Similar to token query, an origin can check whether browser has a valid
redemption record for a specific issuer using following API.</p>
<pre class="language-javascript highlight">document<c- p>.</c->hasRedemptionRecord<c- p>(</c-><c- o>&lt;</c->issuer<c- o>></c-><c- p>)</c->
</pre>
   <p>Browser carries the following steps on redemption query.</p>
   <ol>
    <li data-md>
     <p>Reject if the document is not in a secure context <a data-link-type="biblio" href="#biblio-secure-contexts">[secure-contexts]</a>.</p>
    <li data-md>
     <p>If the issuer is not associated with the top level origin, return false.</p>
    <li data-md>
     <p>Look up the key commitments from storage. If there are key commitments,
     discard tokens from issuer that are signed with keys other than those
     from the issuer’s most recent commitments.</p>
    <li data-md>
     <p>If there is a redemption record for the issuer and topl level pair,
   return true, return false otherwise.</p>
   </ol>
   <p>Similar to token query, redemption query might modify the browser state. Unlike
token query, redemption query does not associate issuer with the top level
origin. There is no need to associate the issuer queried with the top level
origin, because, answer to the redemption query does not leak information about
the issuers of the currently stored tokens. Similar to token query, redemption
query clears stale tokens.</p>
   <h2 class="heading settled" data-level="7" id="privacy"><span class="secno">7. </span><span class="content">Privacy Considerations</span><a class="self-link" href="#privacy"></a></h2>
   <h3 class="heading settled" data-level="7.1" id="unlinkability"><span class="secno">7.1. </span><span class="content">Unlinkability</span><a class="self-link" href="#unlinkability"></a></h3>
   <p>Cryptographic protocols <a data-link-type="biblio" href="#biblio-voprf">[VOPRF]</a> and <a data-link-type="biblio" href="#biblio-pmb">[PMB]</a> provide blind signatures. At
redemption time, issuers can recognize their signature on the provided token,
however they can not determine at what time and context they signed the
token. This prevents issuers to correlate their issuances on an origin with
redemptions on another origin. Issuers learn only the aggregate information
about the origins users visit.</p>
   <h3 class="heading settled" data-level="7.2" id="limit-encoded-info"><span class="secno">7.2. </span><span class="content">Limiting Encoded Information</span><a class="self-link" href="#limit-encoded-info"></a></h3>
   <p>Browsers enforce limit on the number of keys for an issuer. For <a data-link-type="biblio" href="#biblio-voprf">[VOPRF]</a> number of keys are limited to six and for <a data-link-type="biblio" href="#biblio-pmb">[PMB]</a> number of keys are limited to
three. This is to prevent issuers de-anonymizing the clients by using a unique
keys for each clients. At issuance time, when using <a data-link-type="biblio" href="#biblio-voprf">[VOPRF]</a>, the issuer can
label browser by one of the six available labels by using one of the six
keys. Similarly, when using <a data-link-type="biblio" href="#biblio-pmb">[PMB]</a>, the issuer labels the browser in of the
three labels by using its three keys and store an additional private bit value.
This indicates it also places browser into one of six buckets (2 x 3 = 6). Both <a data-link-type="biblio" href="#biblio-voprf">[VOPRF]</a> and <a data-link-type="biblio" href="#biblio-pmb">[PMB]</a> encode the same amount of information in a token. The
difference is <a data-link-type="biblio" href="#biblio-pmb">[PMB]</a> having a private bit.</p>
   <h4 class="heading settled" data-level="7.2.1" id="potential-attack-side-channel-fingerprinting"><span class="secno">7.2.1. </span><span class="content">Potential Attack: Side Channel Fingerprinting</span><a class="self-link" href="#potential-attack-side-channel-fingerprinting"></a></h4>
   <p>Unlinkability is lost if the issuer is able to use network-level fingerprinting
or any other side-channel and can associate the browser at redemption time with
the browser at token issuance time, even though the Trust Token API itself has
only stored and revealed limited amount of information about the browser.</p>
   <h3 class="heading settled" data-level="7.3" id="cross-site-info"><span class="secno">7.3. </span><span class="content">Cross-site Information Transfer</span><a class="self-link" href="#cross-site-info"></a></h3>
   <p>Trust tokens transfer limited information between first-party contexts. Underlying
cryptographic protocols guarantee that each token only contains a small amount
of information. Still, if we allow many token redemptions on a single page, the
first-party cookie for user U on domain A can be encoded in the trust token
information channel and decoded on domain B, allowing domain B to learn the
user’s domain A cookie until either 1p cookie is cleared. Separate from the
concern of channels allowing arbitrary communication between domains, some
identification attacks---for instance, a malicious redeemer attempting to learn
the exact set of issuers that have granted tokens to a particular user, which
could be identifying---have similar mitigations.</p>
   <h4 class="heading settled" data-level="7.3.1" id="mitigation-dynamic-issuance-redemption-limits"><span class="secno">7.3.1. </span><span class="content">Mitigation: Dynamic Issuance/Redemption Limits</span><a class="self-link" href="#mitigation-dynamic-issuance-redemption-limits"></a></h4>
   <p>To mitigate this attack, browser places limits on both issuance and
redemption. User activation with the issuing site is required in the issuing
operation. Browser does not allow a third redemption in a 48 hour window.</p>
   <h4 class="heading settled" data-level="7.3.2" id="mitigation-per-site-issuer-limits"><span class="secno">7.3.2. </span><span class="content">Mitigation: Per-Site Issuer Limits</span><a class="self-link" href="#mitigation-per-site-issuer-limits"></a></h4>
   <p>The rate of identity leakage from one origin to another increases with the
number of issuers allowed in an origin. To avoid abuse, the browser allows
association of at most two issers per top level origin. Issuers are associated
with top level origins for token query API as well, see <a href="#token-query">§ 6.1 Token Query</a>.</p>
   <h2 class="heading settled" data-level="8" id="security"><span class="secno">8. </span><span class="content">Security Considerations</span><a class="self-link" href="#security"></a></h2>
   <h3 class="heading settled" data-level="8.1" id="token-exhaustion"><span class="secno">8.1. </span><span class="content">Preventing Token Exhaustion</span><a class="self-link" href="#token-exhaustion"></a></h3>
   <p>Malicious origins might attempt to exhaust all tokens stored in the browser by
redeeming them all. To prevent this, the browser limits number of redemption
operations. In an origin first two redemptions are allowed, however, the third
redemption is not allowed in a 48 hour window. The third redemption is allowed
once more than 48 hours have elapsed since the first redemption.</p>
   <h3 class="heading settled" data-level="8.2" id="preventing-double-spend"><span class="secno">8.2. </span><span class="content">Preventing Double Spending</span><a class="self-link" href="#preventing-double-spend"></a></h3>
   <p>Issuers can verify that each token is seen only once, because every redemption
is sent to the same token issuer. This means that even if a malicious piece of
malware exfiltrates all of a user’s tokens, the tokens will run out over
time. Issuers can sign fewer tokens at a time to mitigate the risk.</p>
  </main>
  <div data-fill-with="conformance">
   <h2 class="no-ref no-num heading settled" id="w3c-conformance"><span class="content">Conformance</span><a class="self-link" href="#w3c-conformance"></a></h2>
   <h3 class="no-ref no-num heading settled" id="w3c-conventions"><span class="content">Document conventions</span><a class="self-link" href="#w3c-conventions"></a></h3>
   <p>Conformance requirements are expressed
    with a combination of descriptive assertions
    and RFC 2119 terminology.
    The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL”
    in the normative parts of this document
    are to be interpreted as described in RFC 2119.
    However, for readability,
    these words do not appear in all uppercase letters in this specification. </p>
   <p>All of the text of this specification is normative
    except sections explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119">[RFC2119]</a> </p>
   <p>Examples in this specification are introduced with the words “for example”
    or are set apart from the normative text
    with <code>class="example"</code>,
    like this: </p>
   <div class="example" id="w3c-example">
    <a class="self-link" href="#w3c-example"></a> 
    <p>This is an example of an informative example. </p>
   </div>
   <p>Informative notes begin with the word “Note”
    and are set apart from the normative text
    with <code>class="note"</code>,
    like this: </p>
   <p class="note" role="note">Note, this is an informative note.</p>
   <h3 class="no-ref no-num heading settled" id="w3c-conformant-algorithms"><span class="content">Conformant Algorithms</span><a class="self-link" href="#w3c-conformant-algorithms"></a></h3>
   <p>Requirements phrased in the imperative as part of algorithms
    (such as "strip any leading space characters"
    or "return false and abort these steps")
    are to be interpreted with the meaning of the key word
    ("must", "should", "may", etc)
    used in introducing the algorithm. </p>
   <p>Conformance requirements phrased as algorithms or specific steps
    can be implemented in any manner,
    so long as the end result is equivalent.
    In particular, the algorithms defined in this specification
    are intended to be easy to understand
    and are not intended to be performant.
    Implementers are encouraged to optimize. </p>
  </div>
<script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://datatracker.ietf.org/doc/html/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. March 1997. Best Current Practice. URL: <a href="https://datatracker.ietf.org/doc/html/rfc2119">https://datatracker.ietf.org/doc/html/rfc2119</a>
  </dl>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-fetch">[FETCH]
   <dd>Anne van Kesteren. <a href="https://fetch.spec.whatwg.org/"><cite>Fetch Standard</cite></a>. Living Standard. URL: <a href="https://fetch.spec.whatwg.org/">https://fetch.spec.whatwg.org/</a>
   <dt id="biblio-pmb">[PMB]
   <dd>Ben Kreuter; et al. <a href="https://eprint.iacr.org/2020/072"><cite>Anonymous Tokens with Private Metadata Bit</cite></a>. URL: <a href="https://eprint.iacr.org/2020/072">https://eprint.iacr.org/2020/072</a>
   <dt id="biblio-privacy-pass-architecture">[PRIVACY-PASS-ARCHITECTURE]
   <dd>A. Davidson; J. Iyengar; C. A. Wood. <a href="https://www.ietf.org/archive/id/draft-ietf-privacypass-architecture-06.html"><cite>Privacy Pass Architectural Framework</cite></a>. URL: <a href="https://www.ietf.org/archive/id/draft-ietf-privacypass-architecture-06.html">https://www.ietf.org/archive/id/draft-ietf-privacypass-architecture-06.html</a>
   <dt id="biblio-privacy-pass-auth-scheme">[PRIVACY-PASS-AUTH-SCHEME]
   <dd>T. Pauly; S. Valdez; C. A. Wood. <a href="https://www.ietf.org/archive/id/draft-ietf-privacypass-auth-scheme-05.html"><cite>The Privacy Pass HTTP Authentication Scheme</cite></a>. URL: <a href="https://www.ietf.org/archive/id/draft-ietf-privacypass-auth-scheme-05.html">https://www.ietf.org/archive/id/draft-ietf-privacypass-auth-scheme-05.html</a>
   <dt id="biblio-privacy-pass-issuance-protocol">[PRIVACY-PASS-ISSUANCE-PROTOCOL]
   <dd>S. Celi; et al. <a href="https://www.ietf.org/archive/id/draft-ietf-privacypass-protocol-06.html"><cite>Privacy Pass Issuance Protocol</cite></a>. URL: <a href="https://www.ietf.org/archive/id/draft-ietf-privacypass-protocol-06.html">https://www.ietf.org/archive/id/draft-ietf-privacypass-protocol-06.html</a>
   <dt id="biblio-privacy-pass-wg">[PRIVACY-PASS-WG]
   <dd><a href="https://datatracker.ietf.org/wg/privacypass/about/"><cite></cite></a>. URL: <a href="https://datatracker.ietf.org/wg/privacypass/about/">https://datatracker.ietf.org/wg/privacypass/about/</a>
   <dt id="biblio-rfc4648">[RFC4648]
   <dd>S. Josefsson. <a href="https://www.rfc-editor.org/rfc/rfc4648"><cite>The Base16, Base32, and Base64 Data Encodings</cite></a>. October 2006. Proposed Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc4648">https://www.rfc-editor.org/rfc/rfc4648</a>
   <dt id="biblio-rfc6265">[RFC6265]
   <dd>A. Barth. <a href="https://httpwg.org/specs/rfc6265.html"><cite>HTTP State Management Mechanism</cite></a>. April 2011. Proposed Standard. URL: <a href="https://httpwg.org/specs/rfc6265.html">https://httpwg.org/specs/rfc6265.html</a>
   <dt id="biblio-rfc8259">[RFC8259]
   <dd>T. Bray, Ed.. <a href="https://www.rfc-editor.org/rfc/rfc8259"><cite>The JavaScript Object Notation (JSON) Data Interchange Format</cite></a>. December 2017. Internet Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc8259">https://www.rfc-editor.org/rfc/rfc8259</a>
   <dt id="biblio-rfc8446">[RFC8446]
   <dd>E. Rescorla. <a href="https://www.rfc-editor.org/rfc/rfc8446"><cite>The Transport Layer Security (TLS) Protocol Version 1.3</cite></a>. August 2018. Proposed Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc8446">https://www.rfc-editor.org/rfc/rfc8446</a>
   <dt id="biblio-rfc8536">[RFC8536]
   <dd>A. Olson; P. Eggert; K. Murchison. <a href="https://www.rfc-editor.org/rfc/rfc8536"><cite>The Time Zone Information Format (TZif)</cite></a>. February 2019. Proposed Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc8536">https://www.rfc-editor.org/rfc/rfc8536</a>
   <dt id="biblio-secure-contexts">[SECURE-CONTEXTS]
   <dd>Mike West. <a href="https://w3c.github.io/webappsec-secure-contexts/"><cite>Secure Contexts</cite></a>. URL: <a href="https://w3c.github.io/webappsec-secure-contexts/">https://w3c.github.io/webappsec-secure-contexts/</a>
   <dt id="biblio-voprf">[VOPRF]
   <dd>A. Davidson; et al. <a href="https://www.ietf.org/archive/id/draft-irtf-cfrg-voprf-13.html"><cite>Oblivious Pseudorandom Functions (OPRFs) using Prime-Order Groups</cite></a>. URL: <a href="https://www.ietf.org/archive/id/draft-irtf-cfrg-voprf-13.html">https://www.ietf.org/archive/id/draft-irtf-cfrg-voprf-13.html</a>
  </dl>